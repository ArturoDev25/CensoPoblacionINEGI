<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
  <meta charset="UTF-8">
  
  <title>Censo de Municipios</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/base.css}">
  <link rel="stylesheet" th:href="@{/css/municipios/municipios.css}">
  <link rel="stylesheet" th:href="@{/css/municipios/municipios_tooltip.css}">
</head>

<body>

  <nav class="navbar navbar-expand-lg shadow-sm app-bar">
    <div class="container-fluid px-4">
      <a class="navbar-brand fw-bold" href="#" style="color:#007777;">Censo INEGI</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" th:href="@{/municipios}">Municipios</a></li>
          <li class="nav-item"><a class="nav-link" th:href="@{/localidades}">Localidades</a></li>
          <li class="nav-item"><a class="nav-link" th:href="@{/viviendas}">Viviendas</a></li>
          <li class="nav-item"><a class="nav-link" th:href="@{/habitantes}">Habitantes</a></li>
          <li class="nav-item"><a class="nav-link text-danger" th:href="@{/logout}">Cerrar sesión</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container my-5 municipios-container">

    <p class="text-end text-muted small contador-municipios">
      Total:
      <span th:text="${#lists.size(municipios)}"></span>
      <span th:text="${#lists.size(municipios) == 1 ? 'municipio registrado' : 'municipios registrados'}"></span>
    </p>

    <h2 class="fw-bold text-center mb-4">Censo de Municipios</h2>

    <!-- Mensajes de éxito/error -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
      <span th:text="${success}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
      <span th:text="${error}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="text-end mb-3">
      <a th:href="@{/municipios/nuevo}" class="btn btn-main">Nuevo Municipio</a>
    </div>

    <div class="municipios-card p-4">
      <table class="table align-middle text-center">

        <thead>
          <tr>
            <th>Nombre</th>
            <th>Clave INEGI</th>
            <th>Localidades</th>
            <th>Viviendas</th>
            <th>Acciones</th>
          </tr>
        </thead>

        <tbody>

          <tr th:each="m : ${municipios}" class="municipio-row">
            <td th:text="${m.nombre}">Saltillo</td>

            <td>
              <span class="badge-clave" th:text="${m.claveInegi != null ? m.claveInegi : 'N/A'}">05030</span>
            </td>

            <td>
              <span class="localidad-tooltip">
                <span class="badge-habitantes" th:text="${m.localidades != null ? m.localidades.size() : 0}">0</span>
                <span class="tooltip-content" th:if="${m.localidades != null and not #lists.isEmpty(m.localidades)}">
                  <span th:each="l, iterStat : ${m.localidades}" class="localidad-item">
                    <span th:text="${l.nombre}"></span>
                  </span>
                </span>
              </span>
            </td>

            <td>
              <span class="vivienda-tooltip">
                <span class="badge-habitantes" th:text="${m.viviendas != null ? m.viviendas.size() : 0}">0</span>
                <span class="tooltip-content" th:if="${m.viviendas != null and not #lists.isEmpty(m.viviendas)}">
                  <span th:each="v, iterStat : ${m.viviendas}" class="vivienda-item">
                    <span th:text="${v.direccion}"></span>
                  </span>
                </span>
              </span>
            </td>

            <td>
              <a th:href="@{'/municipios/editar/' + ${m.id}}" class="btn btn-edit">Editar</a>
              <a th:href="@{'/municipios/eliminar/' + ${m.id}}" class="btn btn-delete"
                onclick="return confirm('¿Eliminar este municipio? También se eliminarán localidades y viviendas asociadas.')">
                Eliminar
              </a>
            </td>
          </tr>

          <tr th:if="${#lists.isEmpty(municipios)}">
            <td colspan="5" class="text-center py-4 text-muted">
              No hay municipios registrados
            </td>
          </tr>

        </tbody>

      </table>
    </div>

    <div class="mt-4 text-start">
      <a th:href="@{/dashboard}" class="btn btn-back">Volver al Dashboard</a>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>