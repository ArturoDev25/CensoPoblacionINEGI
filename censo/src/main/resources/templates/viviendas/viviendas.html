<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
  <meta charset="UTF-8">
  <title>Censo de Viviendas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/base.css}">
  <link rel="stylesheet" th:href="@{/css/viviendas/viviendas.css}">
  <link rel="stylesheet" th:href="@{/css/viviendas/viviendas_tooltip.css}">

</head>

<body>

  <nav class="navbar navbar-expand-lg shadow-sm app-bar">
    <div class="container-fluid px-4">
      <a class="navbar-brand fw-bold" href="#" style="color: #007777;">
        Censo INEGI
      </a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" th:href="@{/municipios}">Municipios</a></li>
          <li class="nav-item"><a class="nav-link" th:href="@{/localidades}">Localidades</a></li>
          <li class="nav-item"><a class="nav-link active" th:href="@{/viviendas}">Viviendas</a></li>
          <li class="nav-item"><a class="nav-link" th:href="@{/habitantes}">Habitantes</a></li>
          <li class="nav-item"><a class="nav-link text-danger" th:href="@{/logout}">Cerrar sesión</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container my-5 viviendas-container">

    <p class="text-end text-muted small contador-viviendas">
      Total:
      <span th:text="${#lists.size(viviendas)}"></span>
      <span th:text="${#lists.size(viviendas) == 1 ? 'vivienda registrada' : 'viviendas registradas'}"></span>
    </p>

    <h2 class="fw-bold text-center mb-4">Censo de Viviendas</h2>

    <!-- Mensajes de éxito/error -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
      <span th:text="${success}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
      <span th:text="${error}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="text-end mb-3">
      <a th:href="@{/viviendas/nueva}" class="btn btn-main">Nueva Vivienda</a>
    </div>

    <div class="viviendas-card p-4">
      <table class="table align-middle text-center">
        <thead>
          <tr>
            <th>Dirección</th>
            <th>Tipo</th>
            <th>Habitantes</th>
            <th>Servicios</th>
            <th>Municipio</th>
            <th>Acciones</th>
          </tr>
        </thead>

        <tbody>
          <tr th:each="v : ${viviendas}" class="vivienda-row">
            <td th:text="${v.direccion}">Dirección</td>
            <td th:text="${v.tipoVivienda != null ? v.tipoVivienda.descripcion : 'N/A'}">Tipo</td>
            <td>
              <span class="habitante-tooltip">
                <span th:text="${v.numHabitantes}">0</span>
                <span class="tooltip-content" th:if="${v.habitantes != null and not #lists.isEmpty(v.habitantes)}">
                  <span th:each="h, iterStat : ${v.habitantes}" class="habitante-nombre">
                    <span th:text="${h.nombre + ' ' + h.apellidoPaterno + (!#strings.isEmpty(h.apellidoMaterno) ? ' ' + h.apellidoMaterno : '')}"></span>
                  </span>
                </span>
              </span>
            </td>
            <td th:text="${v.tieneServiciosBasicos} ? 'Sí' : 'No'">Sí</td>
            <td th:text="${v.municipio != null ? v.municipio.nombre : 'N/A'}">Municipio</td>
            <td>
              <a th:href="@{'/viviendas/editar/' + ${v.id}}" class="btn btn-edit">Editar</a>
              <a th:href="@{'/viviendas/eliminar/' + ${v.id}}" class="btn btn-delete"
                onclick="return confirm('¿Eliminar esta vivienda?')">Eliminar</a>
            </td>
          </tr>

          <tr th:if="${#lists.isEmpty(viviendas)}">
            <td colspan="6" class="text-center py-4 text-muted">
              No hay viviendas registradas
            </td>
          </tr>
        </tbody>

      </table>
    </div>

    <div class="mt-4 text-start">
      <a th:href="@{/dashboard}" class="btn btn-back">Volver al Dashboard</a>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>