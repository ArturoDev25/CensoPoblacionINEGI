<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
  <meta charset="UTF-8">
  <title>Censo de Localidades</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/base.css}">
  <link rel="stylesheet" th:href="@{/css/localidades/localidades.css}">
  <link rel="stylesheet" th:href="@{/css/localidades/localidades_tooltip.css}">
</head>

<body>

  <nav class="navbar navbar-expand-lg shadow-sm app-bar">
    <div class="container-fluid px-4">
      <a class="navbar-brand fw-bold" href="#" style="color: #007777;">
        Censo INEGI
      </a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" th:href="@{/municipios}">Municipios</a></li>
          <li class="nav-item"><a class="nav-link active" th:href="@{/localidades}">Localidades</a></li>
          <li class="nav-item"><a class="nav-link" th:href="@{/viviendas}">Viviendas</a></li>
          <li class="nav-item"><a class="nav-link" th:href="@{/habitantes}">Habitantes</a></li>
          <li class="nav-item"><a class="nav-link text-danger" th:href="@{/logout}">Cerrar sesión</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container my-5 localidades-container">

    <p class="text-end text-muted small contador-localidades">
      Total:
      <span th:text="${#lists.size(localidades)}"></span>
      <span th:text="${#lists.size(localidades) == 1 ? 'localidad registrada' : 'localidades registradas'}"></span>
    </p>

    <h2 class="fw-bold text-center mb-4">Censo de Localidades</h2>

    <!-- Mensajes de éxito/error -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
      <span th:text="${success}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
      <span th:text="${error}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="text-end mb-3">
      <a th:href="@{/localidades/nueva}" class="btn btn-main">Nueva Localidad</a>
    </div>

    <div class="localidades-card p-4">
      <table class="table align-middle text-center">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Clave INEGI</th>
            <th>Municipio</th>
            <th>Viviendas</th>
            <th>Acciones</th>
          </tr>
        </thead>

        <tbody>
          <tr th:each="l : ${localidades}" class="localidad-row">
            <td th:text="${l.nombre}">Centro Histórico</td>
            <td>
              <span class="badge-clave" th:text="${l.claveInegi != null ? l.claveInegi : 'Sin clave'}">05030A</span>
            </td>
            <td th:text="${l.municipio != null ? l.municipio.nombre : 'N/A'}">Saltillo</td>
            <td>
              <span class="vivienda-tooltip">
                <span class="badge-contador" th:text="${l.viviendas != null ? l.viviendas.size() : 0}">0</span>
                <span class="tooltip-content" th:if="${l.viviendas != null and not #lists.isEmpty(l.viviendas)}">
                  <span th:each="v, iterStat : ${l.viviendas}" class="vivienda-item">
                    <span th:text="${v.direccion}"></span>
                  </span>
                </span>
              </span>
            </td>
            <td>
              <a th:href="@{'/localidades/editar/' + ${l.id}}" class="btn btn-edit">Editar</a>
              <a th:href="@{'/localidades/eliminar/' + ${l.id}}" class="btn btn-delete"
                onclick="return confirm('¿Eliminar esta localidad?')">Eliminar</a>
            </td>
          </tr>

          <tr th:if="${#lists.isEmpty(localidades)}">
            <td colspan="5" class="text-center py-4 text-muted">
              No hay localidades registradas
            </td>
          </tr>
        </tbody>

      </table>
    </div>

    <div class="mt-4 text-start">
      <a th:href="@{/dashboard}" class="btn btn-back">Volver al Dashboard</a>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>